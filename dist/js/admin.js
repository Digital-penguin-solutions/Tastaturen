function on_ready_admin(){$(".add_item").click(function(){var e=this,t=$(this).parent(),a=$(t).find(".template").first().clone().removeClass("template");$(a).find("input").val(""),$(t).append(a),$(a).insertBefore(e),update_remove_listener()}),update_remove_listener()}function update_remove_listener(){$(".remove_item").click(function(){var e=$(this).parent();$(e).parent().children().length-2>1&&$(e).remove()}),$(".image_list_item .remove_item").click(function(){var e=$(this).attr("image_id");if(void 0!=e){var t="<input value = "+e+" type =  'hidden' name = 'removed_images[]'>";$("#form").append(t)}})}function compress_image(e){e=e||window.event;var t=e.target||e.srcElement,a=t.parentNode,n=t.name,i=t.files[0];if(void 0!=i){var r=i.type,d=get_filename_from_path(t.value),m=$(t).attr("image_id");void 0==m&&(m="none");var o=document.createElement("img");o.className+="always_hidden",o.className+=" tmp_holder",o.setAttribute("holder_name",n),o.setAttribute("filename",d),o.setAttribute("image_id",m);$(a).find(".tmp_holder[holder_name='"+n+"']").remove();$(a).append(o);var l=new FileReader;l.onload=function(e){o.src=e.target.result,o.setAttribute("mime",r)},l.readAsDataURL(i)}else $("[holder_name='"+n+"']").remove()}function send_form(e,t){for(var a=new FormData(document.getElementById("form")),n=document.getElementsByClassName("tmp_holder"),i=0;i<n.length;i++){var r=n[i],d=r.getAttribute("holder_name"),m=r.getAttribute("mime"),o=r.naturalWidth,l=r.naturalHeight,s=l/o;o>maxWidth&&(o=maxWidth,l=s*maxWidth);var c="";if("image/png"!=m){var h=document.createElement("canvas");h.width=o,h.height=l;h.getContext("2d").drawImage(r,0,0,o,l),c=h.toDataURL(m,1)}else c=r.src;c+="@)(@#!#!#"+$(r).attr("filename")+"@)(@#!#!#"+$(r).attr("image_id"),"[]"!=d.substring(d.length-2,d.length)&&a.delete(d),a.append(d,c)}$.ajax({url:t,type:"POST",data:a,cache:!1,contentType:!1,processData:!1}).success(function(e){window.location.replace("admin?message=Product has been added or edited")})}function compressPNG(e,t,a){var n=e.naturalWidth,i=e.naturalHeight,r=document.createElement("canvas");r.width=n*t,r.height=i*t,r.getContext("2d").drawImage(e,0,0,r.width,r.height);var d=document.createElement("img");d.src=r.toDataURL(a);var m=document.createElement("canvas");return m.width=n,m.height=i,m.getContext("2d").drawImage(d,0,0,m.width,m.height),m.toDataURL(a)}function get_filename_from_path(e){if(e){var t=e.indexOf("\\")>=0?e.lastIndexOf("\\"):e.lastIndexOf("/"),a=e.substring(t);0!==a.indexOf("\\")&&0!==a.indexOf("/")||(a=a.substring(1))}return a}$(document).ready(on_ready_admin);var maxWidth=1e3;