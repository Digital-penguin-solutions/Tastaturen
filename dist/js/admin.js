function on_ready_admin(){$(".add_item").click(function(){var e=this,t=$(this).parent(),a=$(t).find(".template").first().clone().removeClass("template");$(a).find("input").val(""),$(t).append(a),$(a).insertBefore(e),update_remove_listener()}),update_remove_listener()}function update_remove_listener(){$(".remove_item").click(function(){var e=$(this).parent();$(e).parent().children().length-2>1&&$(e).remove()}),$(".image_list_item .remove_item").click(function(){var e=$(this).attr("image_id");if(void 0!=e){var t="<input value = "+e+" type =  'hidden' name = 'removed_images[]'>";$("#form").append(t)}})}function send_form_stored_image(){send_form("","functions/update_stored_image.php","form_stored_image")}function compress_image_single(e,t){compress_image(e,function(){setTimeout(function(){send_form("","functions/update_stored_image.php","form_stored_image")},2e3)})}function compress_image(e,t){e=e||window.event;var a=e.target||e.srcElement,i=a.parentNode,n=a.name,d=a.files[0];if(void 0!=d){var r=d.type,o=get_filename_from_path(a.value),m=$(a).attr("image_id");void 0==m&&(m="none");var s=document.createElement("img");s.className+="always_hidden",s.className+=" tmp_holder",s.setAttribute("holder_name",n),s.setAttribute("filename",o),s.setAttribute("image_id",m);$(i).find(".tmp_holder[holder_name='"+n+"']").remove();$(i).append(s);var l=new FileReader;l.onload=function(e){s.src=e.target.result,s.setAttribute("mime",r),"none"!=t&&t()},l.readAsDataURL(d)}else $("[holder_name='"+n+"']").remove()}function send_form(e,t,a){e.disabled=!0;for(var i=new FormData(document.getElementById(a)),n=document.getElementsByClassName("tmp_holder"),d=0;d<n.length;d++){var r=n[d],o=r.getAttribute("holder_name"),m=r.getAttribute("mime"),s=r.naturalWidth,l=r.naturalHeight,c=l/s;s>maxWidth&&(s=maxWidth,l=c*maxWidth);var p="";if("image/png"!=m){var u=document.createElement("canvas");u.width=s,u.height=l;u.getContext("2d").drawImage(r,0,0,s,l),p=u.toDataURL(m,.7)}else p=r.src;p+="@)(@#!#!#"+$(r).attr("filename")+"@)(@#!#!#"+$(r).attr("image_id"),"[]"!=o.substring(o.length-2,o.length)&&i.delete(o),i.append(o,p)}$.ajax({url:t,type:"POST",data:i,cache:!1,contentType:!1,processData:!1}).success(function(e){console.log(e);var a="";if("add_product.php"==t)a="Product has been edited or added",window.location.replace("admin?view=products&message="+a);else if("add_media.php"==t)a="Media post has been edited or added",window.location.replace("admin?view=media&message="+a);else if("add_link.php"==t)a="Link has been added or edited",window.location.replace("admin?view=links&message="+a);else if("add_event.php"==t)a="Event has been added or edited",window.location.replace("admin?view=events&message="+a);else{var i=Math.floor(1e3*Math.random()),n=window.location.href;if(n.indexOf("?")>-1){if(n.indexOf("#")>-1)var d=n.split("#"),r=(d[0],d[1]),o=r.split("?"),n="?"+o[1];n+="&r="+i}else{var d=n.split("#"),n=d[0];n+="?r="+i}window.location.replace(n)}})}function compressPNG(e,t,a){var i=e.naturalWidth,n=e.naturalHeight,d=document.createElement("canvas");d.width=i*t,d.height=n*t,d.getContext("2d").drawImage(e,0,0,d.width,d.height);var r=document.createElement("img");r.src=d.toDataURL(a);var o=document.createElement("canvas");return o.width=i,o.height=n,o.getContext("2d").drawImage(r,0,0,o.width,o.height),o.toDataURL(a)}function get_filename_from_path(e){if(e){var t=e.indexOf("\\")>=0?e.lastIndexOf("\\"):e.lastIndexOf("/"),a=e.substring(t);0!==a.indexOf("\\")&&0!==a.indexOf("/")||(a=a.substring(1))}return a}function open_input(e){var t=$("[image_id="+e+"]");$(t).trigger("click")}$(document).ready(on_ready_admin);var maxWidth=1500;